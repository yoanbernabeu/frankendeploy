# {{ .Name }} - FrankenDeploy App Configuration
{{ .Domain }} {
{{- if .TLS }}
    # Automatic HTTPS via Let's Encrypt
{{- else }}
    tls internal
{{- end }}

    # Reverse proxy to application container (port 8080 for non-root execution)
    reverse_proxy {{ .Name }}:8080 {
        # Health checks
        health_uri {{ .HealthPath }}
        health_interval 30s
        health_timeout 5s
        health_status 200

        # Load balancing (for future scaling)
        lb_policy round_robin
        lb_try_duration 5s
        lb_try_interval 250ms
    }

    # Compression
    encode zstd br gzip

    # Security headers
    header {
        # HSTS
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

        # Prevent content type sniffing
        X-Content-Type-Options nosniff

        # Prevent clickjacking
        X-Frame-Options DENY

        # XSS protection
        X-XSS-Protection "1; mode=block"

        # Referrer policy
        Referrer-Policy strict-origin-when-cross-origin

        # Remove server header
        -Server
    }

    # Access logging
    log {
        output file /var/log/caddy/{{ .Name }}-access.log {
            roll_size 10mb
            roll_keep 5
        }
        format json
    }
}
