---
import { getCollection, render } from 'astro:content';
import DocsLayout from '../layouts/DocsLayout.astro';
import { findCurrentSection } from '../utils/navigation';

export async function getStaticPaths() {
  const docs = await getCollection('docs');

  return docs.map((entry) => {
    let slug = entry.id;
    slug = slug.replace(/\.(md|mdx)$/, '');
    if (slug === 'index') slug = '';

    return {
      params: { slug: slug || undefined },
      props: { entry },
    };
  });
}

const { entry } = Astro.props;
const { Content, headings } = await render(entry);
const section = findCurrentSection(entry.id);
---

<DocsLayout
  title={entry.data.title}
  description={entry.data.description}
  headings={headings}
  section={section}
  slug={entry.id}
>
  <Content />
</DocsLayout>
