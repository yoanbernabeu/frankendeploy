---
import Logo from './Logo.astro';
import { navigation } from '../../utils/navigation';

const navItems = [
  { label: 'Docs', href: '/frankendeploy/getting-started/' },
  { label: 'Installation', href: '/frankendeploy/installation/' },
  { label: 'Guides', href: '/frankendeploy/guides/deployment/' },
  { label: 'CLI', href: '/frankendeploy/commands/frankendeploy/' },
];
---

<header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300" id="header">
  <div class="absolute inset-0 bg-[#120020]/80 backdrop-blur-xl border-b border-white/5 opacity-0 transition-opacity duration-300" id="header-bg"></div>

  <div class="relative max-w-7xl mx-auto px-6">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a href="/frankendeploy/" class="flex items-center gap-3 group">
        <Logo size={36} />
        <span class="font-bold text-lg text-white group-hover:text-[#B3D133] transition-colors">FrankenDeploy</span>
      </a>

      <!-- Desktop Nav -->
      <nav class="hidden lg:flex items-center gap-1">
        {navItems.map((item) => (
          <a href={item.href} class="nav-link">
            {item.label}
          </a>
        ))}
      </nav>

      <!-- Actions -->
      <div class="flex items-center gap-4">
        <a
          href="https://github.com/yoanbernabeu/frankendeploy"
          target="_blank"
          rel="noopener"
          class="hidden sm:flex items-center gap-2 px-4 py-2 rounded-lg text-[#C3B2D3] hover:text-white hover:bg-white/5 transition-all"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          <span class="text-sm font-medium">GitHub</span>
        </a>

        <a href="/frankendeploy/getting-started/" class="hidden md:inline-flex btn-lime text-sm px-5 py-2.5">
          Get Started
        </a>

        <!-- Mobile menu -->
        <button
          id="mobile-menu-btn"
          class="lg:hidden p-2 rounded-lg text-[#C3B2D3] hover:text-white hover:bg-white/5 transition-all"
          aria-label="Menu"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Mobile Menu Overlay -->
<div id="mobile-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden"></div>

<!-- Mobile Menu -->
<aside id="mobile-menu" class="fixed top-0 left-0 w-80 h-full bg-[#1a0030] border-r border-white/10 z-50 transform -translate-x-full transition-transform duration-300 lg:hidden">
  <div class="p-6 border-b border-white/10">
    <div class="flex items-center justify-between">
      <a href="/frankendeploy/" class="flex items-center gap-3">
        <Logo size={32} />
        <span class="font-bold text-lg text-white">FrankenDeploy</span>
      </a>
      <button id="mobile-close-btn" class="p-2 rounded-lg text-[#C3B2D3] hover:text-white hover:bg-white/5 transition-all">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <nav class="p-6 space-y-6 overflow-y-auto max-h-[calc(100vh-100px)]">
    {navigation.map((section) => (
      <div class="sidebar-section">
        <h3 class="sidebar-title">{section.title}</h3>
        <ul class="space-y-1">
          {section.items.map((item) => (
            <li>
              <a href={item.href} class="sidebar-link">{item.label}</a>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </nav>
</aside>

<script>
  function initHeader() {
    const headerBg = document.getElementById('header-bg');
    const menuBtn = document.getElementById('mobile-menu-btn');
    const closeBtn = document.getElementById('mobile-close-btn');
    const overlay = document.getElementById('mobile-overlay');
    const menu = document.getElementById('mobile-menu');

    // Reset menu state on page load
    menu?.classList.add('-translate-x-full');
    overlay?.classList.add('opacity-0', 'pointer-events-none');
    document.body.style.overflow = '';

    // Header scroll effect
    function handleScroll() {
      if (window.scrollY > 50) {
        headerBg?.classList.remove('opacity-0');
        headerBg?.classList.add('opacity-100');
      } else {
        headerBg?.classList.add('opacity-0');
        headerBg?.classList.remove('opacity-100');
      }
    }

    function openMenu() {
      menu?.classList.remove('-translate-x-full');
      overlay?.classList.remove('opacity-0', 'pointer-events-none');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      menu?.classList.add('-translate-x-full');
      overlay?.classList.add('opacity-0', 'pointer-events-none');
      document.body.style.overflow = '';
    }

    function handleKeydown(e: KeyboardEvent) {
      if (e.key === 'Escape') closeMenu();
    }

    // Remove old listeners to prevent duplicates
    window.removeEventListener('scroll', handleScroll);
    document.removeEventListener('keydown', handleKeydown);

    // Add listeners
    window.addEventListener('scroll', handleScroll);
    menuBtn?.addEventListener('click', openMenu);
    closeBtn?.addEventListener('click', closeMenu);
    overlay?.addEventListener('click', closeMenu);
    document.addEventListener('keydown', handleKeydown);

    // Initial scroll check
    handleScroll();
  }

  // Run on initial load
  initHeader();

  // Run after Astro client-side navigation
  document.addEventListener('astro:page-load', initHeader);
</script>
